import { getPageImage, source } from '@/lib/source';
import { notFound } from 'next/navigation';
import { ImageResponse } from 'next/og';

export const revalidate = false;

export async function GET(
  _req: Request,
  { params }: RouteContext<'/og/docs/[...slug]'>,
) {
  const { slug } = await params;
  const page = source.getPage(slug.slice(0, -1));
  if (!page) notFound();

  return new ImageResponse(
    <div tw="relative flex w-full h-full bg-[#1A2424]">
      <div tw="absolute left-15 top-0 bottom-0 w-0.5 h-full bg-[#82939333]" />
      <div tw="absolute right-15 top-0 bottom-0 w-0.5 h-full bg-[#82939333]" />
      <div tw="absolute bottom-15 left-0 right-0 w-full h-0.5 bg-[#82939333]" />
      <div tw="absolute top-15 left-0 right-0 w-full h-0.5 bg-[#82939333]" />

      <div tw="absolute top-15 left-[43.5px] w-[35px] h-0.5 bg-[#82939333]" />
      <div tw="absolute left-15 top-[43.5px] h-[35px] w-0.5 bg-[#82939333]" />

      <div tw="absolute bottom-15 left-[43.5px] w-[35px] h-0.5 bg-[#82939333]" />
      <div tw="absolute left-15 bottom-[43.5px] h-[35px] w-0.5 bg-[#82939333]" />

      <div tw="absolute top-15 right-[43.5px] w-[35px] h-0.5 bg-[#82939333]" />
      <div tw="absolute right-15 top-[43.5px] h-[35px] w-0.5 bg-[#82939333]" />

      <div tw="absolute bottom-15 right-[43.5px] w-[35px] h-0.5 bg-[#82939333]" />
      <div tw="absolute right-15 bottom-[43.5px] h-[35px] w-0.5 bg-[#82939333]" />

      <div
        tw="flex flex-col w-full h-full items-start justify-between p-26"
        style={{
          backgroundSize: '100px 100px',
        }}
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={400}
          viewBox="0 0 1333 164"
          fill="#e5ebeb"
        >
          <path d="M263 160 323.319 0h43.052l60.082 158.118-42.342 4.235-11.59-33.882h-55.589L305.815 160H263Zm65.76-65.177h31.46l-16.085-43.529-15.375 43.53ZM435.9 45.882h91.543l2.129 23.765-46.363 56.706h46.6L533.83 160H435.9l-5.204-22.118 47.073-58.353h-37.848L435.9 45.882ZM602.227 41.882c11.827 0 21.841 2.667 30.041 8 8.201 5.334 14.351 12.47 18.451 21.412 4.258 8.941 6.387 18.902 6.387 29.882v12.471h-69.781c1.577 4.863 4.494 8.706 8.752 11.529 4.415 2.667 10.171 4 17.268 4 10.881 0 21.368-2.588 31.46-7.764l12.064 28.941c-4.731 3.451-11.591 6.353-20.579 8.706-8.831 2.353-17.899 3.529-27.203 3.529-13.404 0-25.311-2.274-35.719-6.823-10.25-4.549-18.292-11.294-24.127-20.236-5.835-9.098-8.752-19.921-8.752-32.47 0-12.392 2.68-23.216 8.042-32.47 5.362-9.256 12.695-16.314 21.999-21.177 9.462-5.02 20.027-7.53 31.697-7.53Zm-1.183 34.353c-3.942 0-7.49 1.647-10.644 4.942-2.997 3.294-4.416 7.058-4.258 11.294h29.805c0-3.922-1.262-7.608-3.785-11.06-2.523-3.45-6.229-5.176-11.118-5.176ZM868.862 86.353V160h-43.051V90.353c0-4.392-.71-7.765-2.129-10.118-1.262-2.353-4.258-3.53-8.989-3.53-2.05 0-5.283.707-9.698 2.118-4.416 1.412-8.437 2.903-12.064 4.471V160H749.88V90.353c0-4.392-.71-7.765-2.129-10.118-1.262-2.353-4.258-3.53-8.989-3.53-2.05 0-5.362.707-9.935 2.118-4.415 1.412-8.437 2.903-12.064 4.471V160h-43.051V45.882h25.547l7.569 11.765c16.716-10.353 31.934-15.53 45.654-15.53 15.138 0 26.02 4.707 32.643 14.118 15.612-9.411 30.041-14.117 43.288-14.117 26.966 0 40.449 14.745 40.449 44.235ZM1086.7 86.353V160h-43.05V90.353c0-4.392-.71-7.765-2.13-10.118-1.27-2.353-4.26-3.53-8.99-3.53-2.05 0-5.29.707-9.7 2.118-4.42 1.412-8.44 2.903-12.06 4.471V160h-43.056V90.353c0-4.392-.709-7.765-2.129-10.118-1.261-2.353-4.258-3.53-8.988-3.53-2.051 0-5.362.707-9.935 2.118-4.416 1.412-8.437 2.903-12.064 4.471V160h-43.052V45.882h25.547l7.57 11.765c16.716-10.353 31.934-15.53 45.653-15.53 15.139 0 26.02 4.707 32.644 14.118 15.61-9.411 30.04-14.117 43.29-14.117 26.96 0 40.45 14.745 40.45 44.235ZM1163.79 129.412c2.52 0 6.07-.628 10.64-1.883 4.57-1.411 8.75-2.98 12.54-4.705V46.118h43.05v114.117h-20.82l-12.3-11.764c-16.71 10.353-32.32 15.529-46.83 15.529-13.88 0-24.29-4-31.23-12-6.94-8.157-10.41-18.902-10.41-32.235V46.118h43.06v69.647c0 3.921.94 7.215 2.83 9.882 1.9 2.51 5.05 3.765 9.47 3.765ZM1333 80.235c-5.68 0-11.91 1.177-18.69 3.53-6.78 2.353-12.61 5.412-17.5 9.176V160h-43.05V46.118h21.52L1285.69 60c5.52-3.765 11.83-7.059 18.92-9.882 7.1-2.824 13.65-4.236 19.64-4.236l8.75 34.353ZM96.147.626c19.348-2.461 38.316 2.636 50.704 9.999 12.388 7.363 18.847 15.663 22.829 20.352 3.974 4.681 8.742 13.415 8.76 13.45 0 0 8.37 17.28 16.282 38.226 4.733 12.53 11.639 33.152 17.082 49.756 4.254 12.979-5.446 26.255-19.105 26.255-8.989 0-16.877-5.559-20.683-13.702-.46-.983-.844-1.743-1.097-2.137-2.566-3.982-6.194-2.035-6.194-2.035-.029.015-2.75 1.421-4.071 2.478-3.296 2.637-6.834 5.857-12.123 9.025-6.602 3.954-10.904 5.753-18.404 8.053-7.394 2.267-13.996 3.061-21.945 3.45-6.15.3-8.511.039-13.892-.707-7.763-1.076-13.873-3.192-21.148-6.107-6.803-2.724-9.543-5.109-14.335-8.317-3.723-2.492-5.11-3.605-8.407-6.637-3.492-3.211-6.15-6.362-8.848-10.264-4.955-7.168-6.992-11.339-10.707-19.114C18.459 86.729 5.455 44.798 5.449 44.781L1.056 31.628C-3.311 18.557 6.416 5.05 20.197 5.05h4.323c6.245 0 11.827 3.768 14.378 9.468.528 1.182 2.042 8.078 6.016 8.937 1.523.33 3.46-.479 4.602-1.15 3.008-1.77 12.21-10.708 22.033-14.69 9.339-3.786 14.8-5.744 24.598-6.99Zm10.089 38.403c-23.8 0-43.092 19.294-43.092 43.094s19.293 43.093 43.092 43.093c23.8 0 43.093-19.293 43.093-43.093 0-23.8-19.293-43.093-43.093-43.094Z" />
          <path d="M117.593 46.368a36.984 36.984 0 0 1 7.478 3.332c-.986 7.509-3.952 15.012-4.877 17.217h-.007v.008c-4.49 3.084-7.705 6.44-10.003 9.546.963-10.563 3.145-21.218 7.409-30.103ZM136.037 59.471a64.32 64.32 0 0 0-7.65 2.85c.807-2.54 1.631-5.514 2.229-8.636a37.532 37.532 0 0 1 5.421 5.786ZM141.374 94.536c-4.605 12.876-16.084 22.475-30.025 24.387-.738-5.678-1.661-14.718-1.802-25.002v-.008c.094-1.196.645-5.832 3.86-11.23 3.86.048 16.923 1.026 27.843 11.744a.804.804 0 0 0 .124.109ZM143.557 81.939c0 2.003-.155 3.976-.458 5.894-9.188-7.86-19.083-10.281-25.226-10.99 4.419-4.62 11.192-9.125 21.544-11.99a37.057 37.057 0 0 1 4.14 17.086ZM90.052 55.936a52.699 52.699 0 0 0-7.456-2.912 36.903 36.903 0 0 1 7.517-4.777c-.45 2.944-.38 5.522-.061 7.689ZM103.382 88.618c-1.29-1.414-4.924-4.831-12.194-7.985h-.055c-.187 0-10.934.28-21.436 9.094 3.519 16.575 18.01 29.071 35.508 29.537-.899-6.888-2.018-18.119-1.823-30.646Zm-25.801-30.64a37.39 37.39 0 0 0-6.446 11.152c17.124 2.23 27.158 7.542 32.541 11.589a81.3 81.3 0 0 1 .132-1.91c-.737-2.641-5.404-15.704-26.227-20.83Zm28.635-13.38a37.38 37.38 0 0 0-9.288 1.164h-.008c-2.78 9.32.932 14.54.979 14.602.163.216.287.442.38.683 2.889 2.299 5.088 4.699 6.742 6.951 1.227-8.047 3.269-15.96 6.469-23.028a38.18 38.18 0 0 0-5.274-.373ZM79.772 76.906a46.28 46.28 0 0 0-10.88 5.724c-.017-.234-.017-.46-.017-.692 0-2.338.217-4.629.637-6.85 3.79.467 7.2 1.087 10.26 1.818Z" />
        </svg>

        <div tw="flex flex-row gap-10 w-full justify-between items-end">
          <div tw="flex flex-col">
            <p
              tw="text-[#e5ebeb] text-6xl font-medium mb-0 max-w-2xl overflow-hidden"
              style={{
                textOverflow: 'ellipsis',
                whiteSpace: 'nowrap',
              }}
            >
              {page.data.title}
            </p>
            {page.data.description && (
              <p tw="text-[#e5ebeb] text-2xl mt-6 -mb-2 max-w-2xl">
                {page.data.description}
              </p>
            )}
          </div>

          <div tw="flex ms-6">
            <p tw="text-[#e5ebeb] text-2xl -mb-2">@azemmur</p>
          </div>
        </div>
      </div>
    </div>,
    {
      width: 1200,
      height: 630,
    },
  );
}

export function generateStaticParams() {
  return source.getPages().map((page) => ({
    lang: page.locale,
    slug: getPageImage(page).segments,
  }));
}
